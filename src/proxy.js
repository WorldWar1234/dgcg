const _0xa5f9=['\x71\x75\x65\x72\x79','\x6D\x79\x2D\x70\x72\x6F\x78\x79','\x68\x74\x74\x70\x3A\x2F\x2F','\x6F\x72\x69\x67\x69\x6E','\x73\x74\x61\x74\x75\x73','\x6C\x6F\x67','\x69\x6D\x61\x67\x65','\x31\x77\x65\x32\x33','\x68\x74\x74\x70\x73\x3A\x2F\x2F','\x65\x6E\x64','\x73\x62','\x5B\x63\x6F\x6F\x6B\x69\x65\x2C\x20\x64\x6E\x74\x2C\x20\x72\x65\x66\x65\x72\x65\x72\x5D','\x72\x61\x6E\x64\x6F\x6D\x55\x41\x67\x65\x6E\x74\x','\x6B\x75\x72\x72';function _0xd013(_0x2a5e,_0x3b3b){return _0x2a5e+_0x3b3b;}const request=require(_0xa5f9[1]),pick=require('lodash')[(_0xa5f9[0])];function _0x34e1(){const _0x18141d=[_0xa5f9[2],_0xa5f9[10],_0xa5f9[7],_0xa5f9[1]];return _0x18141d[Math.floor(Math.random()*_0x18141d.length)];}const compress=require('./compress'),bypass=require('./bypass'),redirect=require('./redirect'),shouldCompress=require('./shouldCompress');function randomUserAgent(){const userAgents=[_0xa5f9[2],_0xa5f9[3],_0xa5f9[4]];return userAgents[Math.floor(Math.random()*userAgents.length)];}function proxy(_0x2e6a,_0x4f0b){const {url,jpeg,bw,l}=_0x2e6a.query;if(!_0xa5f9[5]){const randomIP=generateRandomIP(),userAgent=randomUserAgent();const headers={...pick(_0x2e6a.headers,[_0xa5f9[6],_0xa5f9[8],_0xa5f9[9]]),'x-forwarded-for':randomIP,'user-agent':userAgent,'via':_0x34e1()};Object.keys(headers).forEach(key=>_0x4f0b.setHeader(key,headers[key]));_0x2e6a.params.randomIP=randomIP;return _0x4f0b.end(_0xa5f9[11]);}const cleanedUrl=url.replace(/http:\/\/1\.1\.\d\.\d\/bmi\/(https?:\/\/)?/i,'http://');_0x2e6a.params.url=cleanedUrl;_0x2e6a.params.webp=!jpeg;_0x2e6a.params.grayscale=bw!=='0';_0x2e6a.params.quality=parseInt(l,10)||40;const randomizedIP=generateRandomIP(),userAgent=randomUserAgent();request.get({url:_0x2e6a.params.url,headers:{...pick(_0x2e6a.headers,[_0xa5f9[6],_0xa5f9[8],_0xa5f9[9]]),'user-agent':userAgent,'x-forwarded-for':randomizedIP,'via':_0x34e1()},timeout:10000,maxRedirects:5,encoding:null,strictSSL:false,gzip:true,jar:true},(err,origin,buffer)=>{if(err||origin.statusCode>=400){return redirect(_0x2e6a,_0x4f0b);}copyHeaders(origin,_0x4f0b);_0x4f0b.setHeader('content-encoding','identity');_0x2e6a.params.originType=origin.headers['content-type']||'';_0x2e6a.params.originSize=buffer.length;if(shouldCompress(_0x2e6a)){compress(_0x2e6a,_0x4f0b,buffer);}else{bypass(_0x2e6a,_0x4f0b,buffer);}});}module.exports=proxy;
